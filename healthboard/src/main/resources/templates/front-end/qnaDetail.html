<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/default.css}">
    <link rel="stylesheet" th:href="@{/css/header_footer.css}">
    <title>Hellmunity</title>
    <!-- Jquery Import  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        //1. 삭제 버튼 클릭
        function commentDel(boardId, commentId) {
            if (!confirm("댓글을 삭제하시겠습니까?")) {
                return false;
            }
            //댓글 삭제 요청
            $.ajax({
                type: "POST",
                url: "/question/" + boardId + "/comment/" + commentId +"/delete",
                contentType: "application/x-www-form-urlencoded;charset=UTF-8"
            }).done(function (fragment){
                $("#commentList").replaceWith(fragment);
            });
        }
        //2-1 수정 버튼 클릭시
        function commentEdit(commnetId, content, boardId){
            $('#comment'+commnetId).html(
                "<textarea id='edit_content"+commnetId+"'>"+content+"</textarea>"
                +"<style>#edit_content"+commnetId+"{width:740px; height:80px; resize:none;} </style>"
            );

            $('#commentButton'+commnetId).html(
                "<button onclick='commentEditSave("+commnetId+","+boardId+")' id='btnEdit'>완료</button> "
                // +"<button onclick='commentEditCancel("+commnetId+","+boardId+")' id='btnCancel'+ commentId>취소</a>"
                +"<button onclick=location.href='/question/"+ boardId+"' id='btnCancel'>취소</button>"
            );
        }
        //2-2 수정 버튼 클릭 후, 저장하기 버튼 누르기
        function commentEditSave(commentId, boardId){
            var content = $("#edit_content"+commentId).val();
            //댓글 수정 요청
            $.ajax({
                type: "POST",
                url: "/question/" + boardId + "/comment/" + commentId +"/edit",
                data : {"comment" : content},
                contentType: "application/x-www-form-urlencoded;charset=UTF-8"
            }).done(function (fragment){
                $("#commentList").replaceWith(fragment);
            });
        }
        //2-3 수정 버튼 클릭 후, 취소 버튼 누르기
        // function commentEditCancel(commentId, content){
        //     console.log("취소 버튼 클릭");
        //     $('#comment'+commentId).html(
        //         "<div>content</div>"
        //     );
        // }

    </script>
</head>

<body>
<div class="page">
    <!-- header -->
    <header class="header">
        <img th:src="@{/image/dumbel.png}" alt="">
        <a th:href="@{/}"><h1>Hellmunity</h1></a>
    </header>

    <!-- 로그인, 로그아웃 -->
    <ul class="login">
        <a th:if="${session.memberNo}" href="#">
            <li class="login-item">마이페이지</li>
        </a>
        <a th:unless="${session.memberNo}" th:href="@{/members/add}">
            <li class="login-item">회원가입</li>
        </a>

        <a th:if="${session.memberNo}" id="logout" href="#">
            <li class="login-item">로그아웃</li>
        </a>
        </a>
        <a th:unless="${session.memberNo}" th:href="@{/login}">
            <li class="login-item">로그인</li>
        </a>
    </ul>

    <!-- Q&A 상세보기 폼-->
    <div class="main-block">
        <table class="board_view" th:object="${board}">
            <caption>상세보기</caption>
            <colgroup>
                <col width="15%">
                <col width="35%">
                <col width="15%">
                <col width="*">
            </colgroup>

            <tbody>
            <tr>
                <th>제목</th>
                <td th:text="*{communityBoardTitle}"></td>
            </tr>
            <tr>
                <th>작성자</th>
                <td th:text="*{writer.memberName}"></td>
            </tr>
            <tr>
                <th>내용</th>
                <td th:text="*{communityBoardDetail}" colspan="3"></td>
            </tr>
            </tbody>
        </table>
        <a th:href="@{/questions}" id="list" class="btn">목록으로</a>
        <a th:if="${board.writer.memberNo.equals(session.memberNo)}" href="#this" id="modify" class="btn">수정하기</a>
        <a th:if="${board.writer.memberNo.equals(session.memberNo)}" href="#this" id="modify" class="btn">삭제하기</a>

        <!--- 댓글 입력 폼 -->
        <div>
            <form th:action="@{/question/{boardId}/comment(boardId=${board.communityBoardId})}" method="POST"
                  th:object="${comment}">
                <div class="field-error" th:errors="*{content}"></div>
                <div>
                    <textarea name="content" th:field="*{content}" th:errorclass="field-error"></textarea>
                    <button>댓글 작성</button>
                </div>
            </form>
        </div>

        <!--- 댓글 불러오기 -->
        <div>
            <h3>댓글목록</h3>
            <div id="commentList">
                <tr th:each="comment : ${comments}">
                    <div th:text="${comment.writer.memberName}">작성자</div>
                    <div th:text="${comment.commentContent}" th:id="comment+${comment.commentId}">댓글 내용</div>
                    <div th:text="${comment.createdDate}">작성일</div>
                    <div th:id="commentButton + ${comment.commentId}">
                        <button th:if="${comment.writer.memberNo.equals(session.memberNo)}"
                                th:boardId = "${board.communityBoardId}"
                                th:commentId = "${comment.commentId}"
                                th:commentcontent="${comment.commentContent}"
                                th:onclick="commentEdit(this.getAttribute('commentId'), this.getAttribute('commentcontent'), this.getAttribute('boardId'))">수정</button>
                        <button th:if="${comment.writer.memberNo.equals(session.memberNo)}"
                                th:boardId = "${board.communityBoardId}"
                                th:commentId = "${comment.commentId}"
                                th:onclick="commentDel(this.getAttribute('boardId'),this.getAttribute('commentId'))">삭제</button>
                    </div>
                </tr>
            </div>
        </div>
    </div>

    <!-- footer -->

    <footer class="footer">
        <hr>
        <div>
            <ul>
                <li>이메일 : kmw3841@skuniv.ac.kr</li>
                <li>주소 : 서울 성북구 서경대학교</li>
                <li>연락처 : 010-0000-0000</li>
                <li>copry right @ mwkim</li>
            </ul>
        </div>
    </footer>

</div>
</body>

</html>